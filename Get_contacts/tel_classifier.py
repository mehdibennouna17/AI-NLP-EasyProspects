from urllib.parse import urlparse

import phonenumbers

tel_dict = {
    '01':['04 26','04 27','04 50','04 69','04 72','04 74','04 78','04 79','04 81','04 82','03 85','04 87'],'02':['03 23','03 60','03 64','03 65','03 75'],'03':['04 15','04 43','04 44','04 63','04 70'],'04':['04 13','04 84','04 86','04 88','04 92','04 65'],'05':['04 13','04 84','04 86','04 88','04 92','04 65'],'06':['04 22','04 83','04 89','04 92','04 93','04 97','04 23'],'07':['04 26','04 27','04 69','04 75','04 81','04 82','04 87'],'08':['03 10','03 24','03 51','03 52','03 53'],'09':['05 31','05 32','05 61','05 67','05 81','05 82','05 36'],'10':['03 10','03 25','03 51','03 52','03 53'],'11':['04 11','04 30','04 34','04 68','04 49'],'12':['05 31','05 32','05 65','05 67','05 81','05 82','05 36'],'13':['04 13','04 32','04 42','04 84','04 86','04 88','04 89','04 90','04 91','04 65'],'14':['02 14','02 31','02 50','02 61','02 58'],'15':['04 15','04 43','04 44','04 63','04 71'],'16':['05 16','05 17','05 45','05 79','05 86'],'17':['05 16','05 17','05 46','05 79','05 86'],'18':['02 18','02 34','02 36','02 45','02 46','02 48','02 19'],'19':['05 19','05 55','05 87','05 18'], '20': ['04 20','04 95'], '2A':['04 20','04 95'],'2B':['04 20','04 95'],'21':['03 45','03 58','03 71','03 73','03 80','03 79'],'22':['02 22','02 30','02 56','02 57','02 90','02 96','02 21'],'23':['05 19','05 55','05 87','05 18'],'24':['05 24','05 33','05 35','05 40','05 47','05 53','05 64','05 54'],'25':['03 39','03 63','03 70','03 81'],'26':['04 26','04 27','04 69','04 75','04 81','04 82','04 87'],'27':['02 32','02  376 ','02 76','02 77','02 78','02 79'],'28':['02 18','02  327 ','02 34','02 36','02 37','02 45','02 46','02 19'],'29':['02 22','02 29','02 30','02 56','02 57','02 90','02 98','02 21'],'30':['04 11','04 30','04 34','04 66','04 67','04 49'],'31':['05 31','05 32','05 34','05 61','05 62','05 67','05 81','05 82','05 36'],'32':['05 31','05 32','05 61','05 62','05 67','05 81','05 82','05 36'],'33':['05 24','05 33','05 35','05 40','05 47','05 56','05 57','05 64','05 54'],'34':['04 11','04 30','04 34','04 67','04 99','04 49'],'35':['02 22','02 23','02 30','02 56','02 57','02 90','02 99','02 21'],'36':['02 18','02 34','02 36','02 45','02 46','02 54','02 19'],'37':['02 18','02 34','02 36','02 45','02 46','02 47','02 19'],'38':['04 38','04 56','04 57','04 74','04 76','04 80','04 85','04 58'],'39':['03 39','03 63','03 70','03 84'],'40':['05 24','05 33','05 35','05 40','05 47','05 58','05 64','05 54'],'41':['02 18','02 34','02 36','02 45','02 46','02 54','02 19'],'42':['04 26','04 27','04 69','04 77','04 81','04 82','04 87'],'43':['04 15','04 43','04 44','04 63','04 71'],'44':['02 28','02 40','02 44','02 49','02 51','02 52','02 53','02 72','02 85','02 55'],'45':['02 18','02 34','02 36','02 38','02 45','02 19'],'46':['05 31','05 32','05 65','05 67','05 81','05 82','05 36'],'47':['05 24','05 33','05 35','05 40','05 47','05 53','05 64','05 54'],'48':['04 11','04 30','04 34','04 66','04 49'],'49':['02 41','02 44','02 49','02 52','02 53','02 72','02 85','02 55'],'50':['02 14','02 33','02 50','02 61','02 58'],'51':['03 10','03 26','03 51','03 52','03 53'],'52':['03 10','03 25','03 51','03 52','03 53'],'53':['02 43','02 44','02 49','02 52','02 53','02 72','02 85','02 55'],'54':['03 29','03 54','03 55','03 57','03 72','03 82','03 83','03 56'],'55':['03 29','03 54','03 55','03 57','03 72','03 56'],'56':['02 22','02 30','02 56','02 57','02 90','02 97','02 21'],'57':['03 54','03 55','03 57','03 72','03 82','03 87','03 56'],'58':['03 45','03 58','03 71','03 73','03 86','03 79'],'59':['03 20','03 27','03 28','03 59','03 61','03 62','03 66','03 76'],'60':['03 44','03 60','03 64','03 65','03 75'],'61':['02 14','02 33','02 50','02 61','02 58'],'62':['03 21','03 59','03 61','03 62','03 66','03 76'],'63':['04 15','04 43','04 44','04 63','04 73'],'64':['05 24','05 33','05 35','05 40','05 47','05 59','05 64','05 54'],'65':['05 31','05 32','05 61','05 62','05 67','05 81','05 82','05 36'],'66':['04 11','04 30','04 34','04 68','04 49'],'67':['03 67','03 68','03 69','03 88','03 90'],'68':['03 67','03 68','03 69','03 89','03 90'],'69':['04 26','04 27','04 37','04 69','04 72','04 74','04 78','04 81','04 82','04 87'],'70':['03 39','03 63','03 70','03 84'],'71':['03 45','03 58','03 71','03 73','03 85','03 79'],'72':['02 43','02 44','02 49','02 52','02 53','02 72','02 85','02 55'],'73':['04 56','04 57','04 79','04 80','04 85','04 58'],'74':['04 50','04 56','04 57','04 80','04 85','04 58'],'75':['01 40','01 42','01 43','01 44','01 45','01 46','01 47','01 48','01 49','01 53','01 55','01 56','01 70','01 72','01 73','01 74','01 75','01 76','01 77','01 78','01 79','01 80','01 81','01 82','01 83','01 88'],'76':['02 32','02 35','02 76','02 77','02 78','02 79'],'77':['01 60','01 64','01 69','01 88'],'78':['01 30','01 34','01 39','01 88'],'79':['05 16','05 17','05 49','05 79','05 86'],'80':['03 22','03 60','03 64','03 65','03 75'],'81':['05 31','05 32','05 63','05 67','05 81','05 82','05 36'],'82':['05 31','05 32','05 63','05 67','05 81','05 82','05 36'],'83':['04 22','04 83','04 89','04 92','04 94','04 98','04 23'],'84':['04 13','04 32','04 84','04 86','04 88','04 90','04 65'],'85':['02 44','02 49','02 51','02 52','02 53','02 72','02 85','02 55'],'86':['05 16','05 17','05 49','05 79','05 86'],'87':['05 19','05 55','05 87','05 18'],'88':['03 29','03 54','03 55','03 57','03 72','03 56'],'89':['03 45','03 58','03 71','03 73','03 86','03 79'],'90':['03 39','03 63','03 70','03 84'],'91':['01 46','01 60','01 64','01 69','01 88'],'92':['01 41','01 42','01 46','01 47','01 49','01 55','01 76','01 78','01 88'],'93':['01 42','01 43','01 48','01 88'],'94':['01 42','01 43','01 45','01 48','01 49','01 56','01 88'],'95':['01 30','01 34','01 39','01 41','01 48','01 88'],'971':['05 90'],'972':['05 96'],'973':['05 94'],'974':['02 62','02 63'],'975':['05 8'],'976':['02 69'],'977':['05 90'],'978':['05 90']
}


def depth_link(link):
    if link[-1] == "/":link = link[0:len(link)-1]
    o = urlparse(link).path
    N=0
    for u in o:
        if u == '/':N+=1
    return N

def check_tel(tel, cp):
    if len(cp) > 0:
        if not cp[0:2] in ['97']: cp = cp[0:2]
        else: cp = cp[0:3]
            
        if tel[0:2] in ['06', '07', '08', '09']:
            out = True
        else:
            liste = tel_dict[cp] ###
            out = False
            for u in liste:
                if tel[0:len(u)] == u:out=True
    else:
        out = True
    return out

def update_tel_dict(tel, url, tel_dict):
    if len(tel) > 5:
        dept = depth_link(url)
        if tel in tel_dict:
            tel_dict[tel]['depth'] = min(dept, tel_dict[tel]['depth'])
            tel_dict[tel]['tot'] += 1
            if str(dept) in tel_dict[tel]:
                tel_dict[tel][str(dept)] += 1
            else:
                tel_dict[tel][str(dept)] = 1
        else:
            tel_dict[tel] = dict()
            tel_dict[tel]['depth'] = dept
            tel_dict[tel]['tot'] = 1
            tel_dict[tel][str(dept)] = 1
            
        out = tel_dict
    else:
        out = tel_dict
    return out

def classifier(tel_dict):
    if len(tel_dict) > 0:
        min_depth = min([tel_dict[u]['depth'] for u in tel_dict])
        tel_dict = {u: tel_dict[u] for u in tel_dict if tel_dict[u]['depth'] == min_depth}
        
        max_occ = max([tel_dict[u][str(min_depth)] for u in tel_dict])
        tel_dict = {u: tel_dict[u] for u in tel_dict if tel_dict[u][str(min_depth)] == max_occ}
        
        max_tot = max([tel_dict[u]['tot'] for u in tel_dict])
        tel_dict = {u: tel_dict[u] for u in tel_dict if tel_dict[u]['tot'] == max_tot}
        
        out = list(tel_dict)
        out = out[0]
    else:
        out = str()
    return out



def phone_check(text): 
    out = list()
    for match in phonenumbers.PhoneNumberMatcher(text, "FR"):
        a = phonenumbers.format_number(match.number, phonenumbers.PhoneNumberFormat.E164)
        a = '0' + a[3] + ' ' + a[4:6] + ' ' + a[6:8] + ' ' + a[8:10] + ' ' +a[10:12]
        out += [a]
    return out
